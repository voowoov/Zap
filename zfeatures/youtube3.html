<!DOCTYPE html>
<html>

<body>

  <!-- <div>
    <div id="player_main_id"></div>
  </div> -->

  <div class="div_hover_prev">
    <div class="player_prev" id="player_prev_id0"></div>
    <img class="image_prev" src="http://img.youtube.com/vi/aSPicd38y_o/0.jpg" alt="">
  </div>
  <div class="div_hover_prev">
    <div class="player_prev" id="player_prev_id1"></div>
    <img class="image_prev" src="http://img.youtube.com/vi/5ILCDsYM57k/0.jpg" alt="">
  </div>
  <div class="div_hover_prev">
    <div class="player_prev" id="player_prev_id2"></div>
    <img class="image_prev" src="http://img.youtube.com/vi/Kbhxo2kOeu4/0.jpg" alt="">
  </div>
  <div class="div_hover_prev">
    <div class="player_prev" id="player_prev_id3"></div>
    <img class="image_prev" src="http://img.youtube.com/vi/XZK-rUghHVE/0.jpg" alt="">
  </div>

  <style>
    .div_hover_prev {
      position: relative;
      width: 300px;
      height: 200px;
    }
    
    .player_prev {
      position: absolute;
      top: 0;
      left: 0;
    }
    
    .image_prev {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  </style>

  <script>
    var listOfVideos = ["aSPicd38y_o", "5ILCDsYM57k", "Kbhxo2kOeu4", "XZK-rUghHVE"];
    var iter_video = 0;
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    const num_clips = 5;
    var player_prev = [];

    function onYouTubeIframeAPIReady() {
      createPlayers();
    }

    function createPlayers() {
      var elements = document.querySelectorAll('.div_hover_prev');
      // if (second_pass) {
      //   elements = Array.prototype.slice.call(elements, -2);
      // }
      // console.log(elements.length);
      elements.forEach(function(element, index) {
        var image_prev = element.querySelector('img');
        // playerid='player_prev_id'+index.toString();
        playerid = element.querySelectorAll('.player_prev')[0].id;
        console.log(playerid);
        player_prev[index] = new YT.Player(playerid, {
          height: '200',
          width: '300',
          host: 'https://www.youtube-nocookie.com',
          videoId: image_prev.src.slice(0, -6).split('/').pop(),
          playerVars: {
            'playsinline': 1,
            'modestbranding': 1,
            'showinfo': 0,
            'controls': 0,
          },
          events: {
            'onReady': onListPlayerReady,
          },
        });

        function onListPlayerReady(event) {
          if (event.target.getDuration() === 0) {
            console.log('unavailable');
          } else {
            var elements = document.querySelectorAll('.div_hover_prev');
            player_prev[index].mute();

            var mouse_out_done = true;
            var duration_clip = player_prev[index].getDuration() / num_clips;
            var previewInterval;
            var previewTimeout;
            var player_prev_container = document.querySelector('#player_prev_id');
            element.onmouseenter = (event) => {
              if (mouse_out_done) {
                // leave fraction of seconds
                previewTimeout = setTimeout(function() {
                  image_prev.style.opacity = 0;
                  player_prev[index].playVideo();
                  iter_clip = 1;
                  previewInterval = setInterval(function() {
                    if (iter_clip < num_clips) {
                      player_prev[index].seekTo(iter_clip * duration_clip);
                      iter_clip++;
                    } else {
                      mouse_out_done = false;
                      image_prev.style.opacity = 1;
                      player_prev[index].stopVideo();
                      clearInterval(previewInterval);
                    }
                  }, 1000);
                }, 200);
              }
            }
            element.onmouseleave = (event) => {
              image_prev.style.opacity = 1;
              clearTimeout(previewTimeout);
              clearInterval(previewInterval);
              player_prev[index].stopVideo()
              mouse_out_done = true;
            };
          }
        }
      });

      //   player_main = new YT.Player('player_main_id', {
      //     height: '390',
      //     width: '640',
      //     host: 'https://www.youtube-nocookie.com',
      //     // videoId: '0UgimeJW1Hc',
      //     videoId: listOfVideos[0],
      //     playerVars: {
      //       'playsinline': 1,
      //       'modestbranding': 1,
      //       'showinfo': 0,
      //       'controls': 1,
      //     },
      //     events: {
      //       'onReady': onMainPlayerReady,
      //       'onStateChange': onMainPlayerStateChange
      //     },
      //   });
    }

    // function onMainPlayerReady(event) {
    //   ////// check if video is unavailable //////
    //   if (event.target.getDuration() === 0) {
    //     console.log('unavailable');
    //   } else {
    //     ////// play video right away but with mute //////
    //     // event.target.mute();
    //     // event.target.playVideo();
    //   }
    // }

    // // var done = false;
    // function onMainPlayerStateChange(event) {
    //   if (event.data === YT.PlayerState.ENDED) {
    //     iter_video++;
    //     event.target.loadVideoById(listOfVideos[iter]);
    //     // event.target.videoId = "G9ToPc1SlWs";
    //     event.target.playVideo();
    //   }
    // }


    // setTimeout(function() {
    //   console.log('timed');
    //   player_prev[0].loadVideoById("XZK-rUghHVE")
    //   player_prev[0].playVideo();
    //   // createPlayers();
    //   console.log('timed');
    // }, 5000);
  </script>
</body>

</html>