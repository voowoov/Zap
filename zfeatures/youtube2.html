<!DOCTYPE html>
<html>

<body>

  <!-- <div id="player_main" style="pointer-events:none" ></div> -->
  <!-- <iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/sOwtIkAO3ZI" 
  frameborder="0" allow="accelerometer; autoplay; 
  encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> -->
  <div>
    <div id="player_main_id"></div>
  </div>
  <div class="div_hover_prev">
    <div class="player_prev" id="player_prev_id"></div>
    <img class="image_prev" src="http://img.youtube.com/vi/aSPicd38y_o/0.jpg" alt="">
  </div>
  <div class="div_hover_prev">
    <img class="image_prev" src="http://img.youtube.com/vi/5ILCDsYM57k/0.jpg" alt="">
  </div>

  <style>
    .div_hover_prev {
      position: relative;
      width: 300px;
      height: 200px;
    }
    
    .player_prev {
      position: absolute;
      top: 0;
      left: 0;
    }
    
    .image_prev {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  </style>

  <script>
    var listOfVideos = ["aSPicd38y_o", "5ILCDsYM57k", "Kbhxo2kOeu4", "XZK-rUghHVE"];
    var iter = 0
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player_main;
    var player_prev;

    function onYouTubeIframeAPIReady() {
      player_main = new YT.Player('player_main_id', {
        height: '390',
        width: '640',
        host: 'https://www.youtube-nocookie.com',
        // videoId: '0UgimeJW1Hc',
        videoId: listOfVideos[0],
        playerVars: {
          'playsinline': 1,
          'modestbranding': 1,
          'showinfo': 0,
          'controls': 1,
        },
        events: {
          'onReady': onMainPlayerReady,
          'onStateChange': onMainPlayerStateChange
        },
      });
      player_prev = new YT.Player('player_prev_id', {
        height: '200',
        width: '300',
        host: 'https://www.youtube-nocookie.com',
        // videoId: '0UgimeJW1Hc',
        videoId: listOfVideos[0],
        playerVars: {
          'playsinline': 1,
          'modestbranding': 1,
          'showinfo': 0,
          'controls': 0,
        },
        events: {
          'onReady': onListPlayerReady,
        },
      });
    }

    function onMainPlayerReady(event) {
      ////// check if video is unavailable //////
      if (event.target.getDuration() === 0) {
        console.log('unavailable');
      } else {
        ////// play video right away but with mute //////
        // event.target.mute();
        // event.target.playVideo();
      }
    }

    // var done = false;
    function onMainPlayerStateChange(event) {
      if (event.data === YT.PlayerState.ENDED) {
        iter++;
        event.target.loadVideoById(listOfVideos[iter]);
        // event.target.videoId = "G9ToPc1SlWs";
        event.target.playVideo();
      }
    }

    function onListPlayerReady(event) {
      ////// check if video is unavailable //////
      if (event.target.getDuration() === 0) {
        console.log('unavailable');
      } else {
        var elements = document.querySelectorAll('.div_hover_prev');
        const num_clips = 5
        player_prev.mute();
        elements.forEach(function(element) {
          var image_prev = element.querySelector('img');
          var mouse_out_done = true;
          var duration_clip = player_prev.getDuration() / num_clips;
          var previewInterval;
          var previewTimeout;
          var player_prev_container = document.querySelector('#player_prev_id');
          element.onmouseenter = (event) => {
            if (mouse_out_done) {
              // leave fraction of seconds
              previewTimeout = setTimeout(function() {
                image_prev.style.opacity = 0;
                var video_id_from_image_url = String(image_prev.src.slice(0, -6).split('/').pop())
                console.log(video_id_from_image_url);
                // player_prev.loadVideoById(video_id_from_image_url);
                setTimeout(function() {
                  console.log(player_prev.getVideoData().video_id);
                  // console.log(image_prev.src.slice(0, -6).split('/').pop()); 
                  // console.log(player_prev.getVideoData().video_id); 
                  player_prev.playVideo();
                  element.insertBefore(player_prev_container, element.firstChild);

                  iter_clip = 1;
                  previewInterval = setInterval(function() {
                    if (iter_clip < num_clips) {
                      player_prev.seekTo(iter_clip * duration_clip);
                      iter_clip++;
                    } else {
                      mouse_out_done = false;
                      image_prev.style.opacity = 1;
                      player_prev.stopVideo();
                      clearInterval(previewInterval);
                    }
                  }, 1000);
                }, 3000);

              }, 200);
            }
            element.onmouseleave = (event) => {
              image_prev.style.opacity = 1;
              clearTimeout(previewTimeout);
              clearInterval(previewInterval);
              player_prev.stopVideo()
              mouse_out_done = true;
            };
          };
        });
        //// play video right away but with mute //////
        event.target.mute();
        event.target.playVideo();
      }
    }

    // setTimeout(function() {
    //   console.log(player_prev.getVideoData().video_id); 
    // }, 5000);
  </script>
</body>

</html>